---
title: Install Portworx on Azure Red Hat OpenShift
linkTitle: Azure Red Hat OpenShift
weight: 200
keywords: Install, on-premises, OpenShift, kubernetes, k8s, ARO, Azure, OpenShift
description: Install Portworx on Azure Red Hat OpenShift
---

## Prerequisites

* [Azure CLI](https://docs.microsoft.com/en-us/cli/azure/install-azure-cli)
* Logged in to your Azure account through the [CLI](https://docs.microsoft.com/en-us/cli/azure/get-started-with-azure-cli)


## Procedure

* Follow the [cluster creation tutorial](https://docs.microsoft.com/en-us/azure/openshift/tutorial-create-cluster ) in the Microsoft Azure documentation, including the *Get a Red Hat pull secret (optional)* section.
* Follow the [cluster connection tutorial](https://docs.microsoft.com/en-us/azure/openshift/tutorial-connect-cluster) in the Microsoft Azure documentation.


### Find the ARO Service Principal

When deploying Portworx on Azure Red Hat Openshift (ARO), the virtual machines are created in a resource group with a `Deny Assignment` role that prevents any service principal from accessing virtual machines except the service principal created for the resource group. In this task, you identify the service principal for the resource group that has access, and configure it to pass on the credentials (Azure Client ID, Azure Client Secret, and Tenant ID) via the Portworx cluster spec. Portworx will fetch the `px-azure` secret object file to authenticate. Perform the following steps from your Azure Web UI:

1. Select **Virtual Machines** from the top navigation menu.
2. From the *Virtual machines* page, select the **Resource Group** associated with your cluster.
3. From the left panel on the **Resource group** page, select **Access control (IAM)**.
4. On the **Access control (IAM)** subpage of your resource group, select **Deny assignments** from the toolbar in the center of the page, then select the link under the **Name** column (this will likely be an autogenerated string of letters and numbers).
5. This page shows that all principals are denied access, except for your resource group. Select your resource group's name.
6. From the application page, copy and save the following values: 
    * Name
    * Application ID
    * Object ID
    
    You will use these to create the `px-azure` secret.

7. From the home page, open the **Azure Active Directory** page (select **All services** to see the option). Select **App registrations** on the left pane, followed by *All applications*. In the search bar in the center of the page, paste the application name you saved in the previous step and press the enter key. Select the application link that shows in the results to open the next page.
8. From your application's page, select **Certificates & secrets** under **Manage** from the left pane.
9. From the **Certificates & secrets** page, select **+ New client secret** to create a new secret. On the **Add a client secret** page, provide the description and expiry date of your secret and click **Add**. 
10. You can see the newly created secret listed on the **Client secret** subpage. Copy and save the following values of your newly created secret:
  * Value 
  * Secret ID

### Create the px-azure secret with Service Principal credentials

Create a secret called `px-azure` to give Portworx access to Azure APIs by updating the following fields with the associated fields from the service principal you created in the previous section.

  ```text
   ./oc create secret generic -n portworx px-azure\
   --from-literal=AZURE_TENANT_ID=<tenant> \
   --from-literal=AZURE_CLIENT_ID=<appId> \
  --from-literal=AZURE_CLIENT_SECRET=<value>
  ```
  ```output
  secret/px-azure created
  ```
   * `AZURE_TENANT_ID`: Run the `az login` command to get this value 
   * `AZURE_CLIENT_ID`: Provide the Application ID associated with your cluster's resource group, which you saved in step 6 of the previous section
   * `AZURE_CLIENT_SECRET`: Provide the Value of your secret, which you saved in the step 10 of the previous section

### Generate Portworx spec

1. Navigate to [PX-Central](https://central.portworx.com/) to generate an installation spec.

2. Click **Continue** with the Portworx Enterprise option:
    ![PX option screen](/img/pxcentral-install.png)

3. Choose an appropriate license for your requirement and click **Continue**:
    ![PX license screen](/img/pxcentral-license.png)

4. On the **Basic** tab, ensure that the **Use the Portworx Operator** option is selected. Choose at least version 2.12 from the **Portworx Versions** dropdown, keep the default namespace name in the **Namespace** field, choose **Built-in** ETCD if you have no external ETCD cluster, and click **Next**:
  ![basic screen](/img/aro/image5.png)
  

5. On the **Storage** tab, select **Cloud** as your environment, select **AZURE** as cloud platform from the dropdown, then click **Next**.

6. From the **Network** tab, choose your network and click **Next**.
7. On the **Customize** page, select **ARO Microsoft Azure Red Hat OpenShift** option, then click **Finish** to generate the Portworx spec. Download and save the spec for future reference.

### Install Portworx Operator using OpenShift UI

1. From your OpenShift UI, select **OperatorHub** in the left pane.
2. On the **OperatorHub** page, search for Portworx and select the **Portworx Enterprise** or **Portworx Essentials** card:

    ![search catalog](/img/aro/oc-px-search-catalog.png)

3. Click **Install** to install Portworx Operator:

    ![select catalog](/img/openshift-vsphere/image17-2.png)

4. Portworx Operator begins to install and takes you to the **Install Operator** page. On this page, select the **A specific namespace on the cluster** option for **Installation mode**. Choose the **Create Project** option from the **Installed Namespace** dropdown:

    ![Installed operator page](/img/aro/oc-namesapce-operator.png)

5. In the **Create Project** window, provide the name `portworx` and click **Create** to create a namespace called **portworx**.

5. Click **Install** to deploy Portworx Operator in the `portworx` namespace.

### Deploy Portworx using OpenShift UI
 
1. Once the Operator is successfully installed, a **Create StorageCluster** button appears. Click the button to create a StorageCluster object:

    ![Portworx Operator](/img/aro/aro-px-storagecluster.png)

2. On the **Create StorageCluster** page, choose **YAML view** to configure the StorageCluster object.

3. Copy and paste the Portworx spec that you generated in the *Generate Portworx spec* section into the text editor, then click **Create** to deploy Portworx: 

    ![YAML view](/img/aro/oc-config-yaml.png)
   
4. Verify that Portworx has deployed successfully by navigating to the **Storage Cluster** tab of the Installed Operators page. Once Portworx has fully deployed, the status will show as Online:

      ![Portworx status](/img/aro/portworx-installed.png)

{{< content "shared/post-installation-ocp.md" >}}